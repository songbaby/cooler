<script type="text/JavaScript" src='{$Think.const.JS_URL}jquery_1.6.1.js'></script>

<php>
    import('Class.Category',APP_PATH);
    $cate = M('cate')->order('id')->select();
    $cate = Category::unLimitedForLevel($cate);
    $cids = Category::getChildsId($cate,4);

    $allstr = json_encode($cate);

</php>

{/* 这是模板注释内容*/ }



<script language=javascript>


    $(function(){
        var   allstr = '<?php echo $allstr ?>';
        var allarray=eval("("+allstr+")");

        var txtHtml ="";
        $.each(allarray,function(key,val){
            if(val.pid == 4 || val.pid == 5 || val.pid == 5 || val.pid == 38) {
                txtHtml += '<a href="#" id='+val.id+'>'+ " " +val.name +'</a>';
            }
        });
        $("#countydiv").html(txtHtml); // 把返回的数据添加到页面上


        $('#countydiv > a').live('click',function() {

            var id =$(this).attr('id');
            currentcounty=$(this).html();

            var txtHtml ="";
            $.each(allarray,function(key,val){
                if(val.pid == id) {
                    txtHtml += '<a href="#" id='+val.id+'>'+ " " +val.name +'</a>';
                }
            });
            $("#towndiv ").html(txtHtml);
            getBoundary();

            $.post("__MODULE__/Cooler/getcooler", {
                cid :  id ,
            }, function (data, textStatus){

                var allOverlay = map.getOverlays();
                var len = allOverlay.length;

                for (var i = 0; i < len; i++){
                    if(allOverlay[i] instanceof BMap.Marker){
                        map.removeOverlay(allOverlay[i]);
                    }
                }

                $.each(data,function(key,val){
                    AddCooler(val.lng, val.lat);
                });
            },"json");


        })

        $('#towndiv > a').live('click',function() {

            var id =$(this).attr('id');

            $.post("__MODULE__/Cooler/getcooler", {
                cid :  id ,
            }, function (data, textStatus){

                var allOverlay = map.getOverlays();
                var len = allOverlay.length;
                for (var i = 0; i < len; i++){
                    if(allOverlay[i] instanceof BMap.Marker){
                        map.removeOverlay(allOverlay[i]);
                    }
                }

                $.each(data,function(key,val){
                    AddCooler(val.lng, val.lat);
                });
            },"json");


        })

    })


</script>


<div class='top-list-wrap'>
    <div class='top-list'>
        <ul class='l-list'>
            <li><a href="__MODULE__/Index/index" >首页</a></li>
            <li><a href="#" >地图</a></li>
            <li><a href="#">列表</a></li>

        </ul>
        <ul class='r-list'>
            <li><a href="/cooler/index.php/Admin/Manager/login">登录</a></li>
            <li><a href="#">注册</a></li>
        </ul>
    </div>
</div>


<div id="nav">
    <div align="left">
        <div id='countydiv' style="text-align: left">
        </div>

        <div id='towndiv' style="text-align: left">
        </div>

        </div>





</div>
